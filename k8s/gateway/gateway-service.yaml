apiVersion: v1
kind: Service
metadata:
  name: api-gateway-service
  namespace: gateway-system
  labels:
    app: api-gateway
spec:
  type: ClusterIP
  selector:
    app: api-gateway
  ports:
    - port: 80
      targetPort: 8080
      name: http
      protocol: TCP

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: gateway-ingress
  namespace: gateway-system
  labels:
    app: api-gateway
  annotations:
    # K3s 默认使用 Traefik 作为 Ingress Controller
    # Traefik 会自动处理，如果需要 HTTPS 可以配置证书
    # 注意：K3s 的 Traefik 默认端口是 80 (HTTP) 和 443 (HTTPS)
spec:
  # K3s Traefik 会自动处理，也可以明确指定 ingressClassName
  ingressClassName: traefik
  rules:
    - host: gateway.example.com  # 修改为您的域名，或使用 IP 访问则删除此 host
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: api-gateway-service
                port:
                  number: 80
    # 如果没有域名，可以通过 IP 访问（删除 host 字段）
    - http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: api-gateway-service
                port:
                  number: 80